cmake_minimum_required(VERSION 3.18)
project(XGBoost_Deploy)

# 1. 경로 정의
set(XGB_SRC "${CMAKE_CURRENT_SOURCE_DIR}/external/xgboost")
set(OUT_INC "${CMAKE_CURRENT_SOURCE_DIR}/include")
set(OUT_LIB "${CMAKE_CURRENT_SOURCE_DIR}/lib")

# 2. XGBoost 빌드 옵션 (Windows/Visual Studio용)
set(XGBOOST_BUILD_STATIC_LIB OFF CACHE BOOL "Build Shared (.dll)")
set(USE_OPENMP ON CACHE BOOL "Enable Multi-threading")

# 3. XGBoost 서브프로젝트 포함
add_subdirectory(${XGB_SRC} EXCLUDE_FROM_ALL)

# 4. 빌드 후 배포 (Post-Build) - /include와 /lib로 자동 복사
add_custom_command(TARGET xgboost POST_BUILD
    # include/xgboost 폴더 생성 및 헤더 복사
    COMMAND ${CMAKE_COMMAND} -E make_directory "${OUT_INC}/xgboost"
    COMMAND ${CMAKE_COMMAND} -E copy_directory "${XGB_SRC}/include/xgboost" "${OUT_INC}/xgboost"
    
    # lib 폴더 생성 및 바이너리(.lib, .dll) 복사
    COMMAND ${CMAKE_COMMAND} -E make_directory "${OUT_LIB}"
    COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_FILE:xgboost> "${OUT_LIB}/"
    COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_LINKER_FILE:xgboost> "${OUT_LIB}/"
    
    COMMENT "XGBoost v3.2.0 binaries deployed to project root /include and /lib"
)